/*
* LoadQueue
* Visit http://createjs.com/ for documentation, updates and examples.
*
*
* Copyright (c) 2012 gskinner.com, inc.
*
* Permission is hereby granted, free of charge, to any person
* obtaining a copy of this software and associated documentation
* files (the "Software"), to deal in the Software without
* restriction, including without limitation the rights to use,
* copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the
* Software is furnished to do so, subject to the following
* conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
* OTHER DEALINGS IN THE SOFTWARE.
*/

this.createjs=this.createjs||{},function(){var e=function(e,t){this.init(e,t)},t=e.prototype=new createjs.AbstractLoader,n=e;n.LOAD_TIMEOUT=8e3,n.BINARY="binary",n.CSS="css",n.IMAGE="image",n.JAVASCRIPT="javascript",n.JSON="json",n.JSONP="jsonp",n.SOUND="sound",n.SVG="svg",n.TEXT="text",n.XML="xml",n.POST="POST",n.GET="GET",t.useXHR=!0,t.stopOnError=!1,t.maintainScriptOrder=!0,t.next=null,t.onFileLoad=null,t.onFileProgress=null,t._typeCallbacks=null,t._extensionCallbacks=null,t._loadStartWasDispatched=!1,t._maxConnections=1,t._currentlyLoadingScript=null,t._currentLoads=null,t._loadQueue=null,t._loadQueueBackup=null,t._loadItemsById=null,t._loadItemsBySrc=null,t._loadedResults=null,t._loadedRawResults=null,t._numItems=0,t._numItemsLoaded=0,t._scriptOrder=null,t._loadedScripts=null,t.init=function(e,t){this._numItems=this._numItemsLoaded=0,this._paused=!1,this._loadStartWasDispatched=!1,this._currentLoads=[],this._loadQueue=[],this._loadQueueBackup=[],this._scriptOrder=[],this._loadedScripts=[],this._loadItemsById={},this._loadItemsBySrc={},this._loadedResults={},this._loadedRawResults={},this._typeCallbacks={},this._extensionCallbacks={},this._basePath=t,this.setUseXHR(e)},t.setUseXHR=function(e){return this.useXHR=e!=0&&window.XMLHttpRequest!=null,this.useXHR},t.removeAll=function(){this.remove()},t.remove=function(e){var t=null;if(!e||e instanceof Array){if(e)t=e;else if(arguments.length>0)return}else t=[e];var n=!1;if(!t){this.close();for(var r in this._loadItemsById)this._disposeItem(this._loadItemsById[r]);this.init(this.useXHR)}else{while(t.length){var i=t.pop(),s=this.getResult(i);for(o=this._loadQueue.length-1;o>=0;o--){u=this._loadQueue[o].getItem();if(u.id==i||u.src==i){this._loadQueue.splice(o,1)[0].cancel();break}}for(o=this._loadQueueBackup.length-1;o>=0;o--){u=this._loadQueueBackup[o].getItem();if(u.id==i||u.src==i){this._loadQueueBackup.splice(o,1)[0].cancel();break}}if(s)delete this._loadItemsById[s.id],delete this._loadItemsBySrc[s.src],this._disposeItem(s);else for(var o=this._currentLoads.length-1;o>=0;o--){var u=this._currentLoads[o].getItem();if(u.id==i||u.src==i){this._currentLoads.splice(o,1)[0].cancel(),n=!0;break}}}n&&this._loadNext()}},t.reset=function(){this.close();for(var e in this._loadItemsById)this._disposeItem(this._loadItemsById[e]);var t=[];for(i=0,l=this._loadQueueBackup.length;i<l;i++)t.push(this._loadQueueBackup[i].getItem());this.loadManifest(t,!1)},n.isBinary=function(e){switch(e){case createjs.LoadQueue.IMAGE:case createjs.LoadQueue.BINARY:return!0;default:return!1}},t.installPlugin=function(e){if(e==null||e.getPreloadHandlers==null)return;var t=e.getPreloadHandlers();if(t.types!=null)for(var n=0,r=t.types.length;n<r;n++)this._typeCallbacks[t.types[n]]=t.callback;if(t.extensions!=null)for(n=0,r=t.extensions.length;n<r;n++)this._extensionCallbacks[t.extensions[n]]=t.callback},t.setMaxConnections=function(e){this._maxConnections=e,!this._paused&&this._loadQueue.length>0&&this._loadNext()},t.loadFile=function(e,t,n){if(e==null){this._sendError({text:"PRELOAD_NO_FILE"});return}this._addItem(e,n),t!==!1?this.setPaused(!1):this.setPaused(!0)},t.loadManifest=function(e,t,n){var r=null;if(e instanceof Array){if(e.length==0){this._sendError({text:"PRELOAD_MANIFEST_EMPTY"});return}r=e}else{if(e==null){this._sendError({text:"PRELOAD_MANIFEST_NULL"});return}r=[e]}for(var i=0,s=r.length;i<s;i++)this._addItem(r[i],n);t!==!1?this.setPaused(!1):this.setPaused(!0)},t.load=function(){this.setPaused(!1)},t.getItem=function(e){return this._loadItemsById[e]||this._loadItemsBySrc[e]},t.getResult=function(e,t){var n=this._loadItemsById[e]||this._loadItemsBySrc[e];if(n==null)return null;var r=n.id;return t&&this._loadedRawResults[r]?this._loadedRawResults[r]:this._loadedResults[r]},t.setPaused=function(e){this._paused=e,this._paused||this._loadNext()},t.close=function(){while(this._currentLoads.length)this._currentLoads.pop().cancel();this._scriptOrder.length=0,this._loadedScripts.length=0,this.loadStartWasDispatched=!1},t._addItem=function(e,t){var n=this._createLoadItem(e);if(n==null)return;var r=this._createLoader(n,t);r!=null&&(this._loadQueue.push(r),this._loadQueueBackup.push(r),this._numItems++,this._updateProgress(),this.maintainScriptOrder&&n.type==createjs.LoadQueue.JAVASCRIPT&&r instanceof createjs.XHRLoader&&(this._scriptOrder.push(n),this._loadedScripts.push(null)))},t._createLoadItem=function(e){var t=null;switch(typeof e){case"string":t={src:e};break;case"object":window.HTMLAudioElement&&e instanceof HTMLAudioElement?t={tag:e,src:t.tag.src,type:createjs.LoadQueue.SOUND}:t=e;break;default:}var n=this._parseURI(t.src);n!=null&&(t.ext=n[5]),t.type==null&&(t.type=this._getTypeByExtension(t.ext)),t.type==createjs.LoadQueue.JSON&&t.callback!=null&&(t.type=createjs.LoadQueue.JSONP);if(t.type==createjs.LoadQueue.JSONP&&t.callback==null)throw new Error("callback is required for loading JSONP requests.");t.tag==null&&(t.tag=this._createTag(t.type));if(t.id==null||t.id=="")t.id=t.src;var r=this._typeCallbacks[t.type]||this._extensionCallbacks[t.ext];if(r){var i=r(t.src,t.type,t.id,t.data);if(i===!1)return null;i!==!0&&(i.src!=null&&(t.src=i.src),i.id!=null&&(t.id=i.id),i.tag!=null&&i.tag.load instanceof Function&&(t.tag=i.tag),i.completeHandler!=null&&(t.completeHandler=i.completeHandler)),i.type&&(t.type=i.type),n=this._parseURI(t.src),n!=null&&n[5]!=null&&(t.ext=n[5].toLowerCase())}return this._loadItemsById[t.id]=t,this._loadItemsBySrc[t.src]=t,t},t._createLoader=function(e,t){var n=this.useXHR;switch(e.type){case createjs.LoadQueue.JSON:case createjs.LoadQueue.XML:case createjs.LoadQueue.TEXT:n=!0;break;case createjs.LoadQueue.SOUND:case createjs.LoadQueue.JSONP:n=!1}return t==null&&(t=this._basePath),n?new createjs.XHRLoader(e,t):new createjs.TagLoader(e,t)},t._loadNext=function(){if(this._paused)return;this._loadStartWasDispatched||(this._sendLoadStart(),this._loadStartWasDispatched=!0),this._numItems==this._numItemsLoaded&&(this.loaded=!0,this._sendComplete(),this.next&&this.next.load&&this.next.load());for(var e=0,t=this._loadQueue.length;e<t;e++){if(this._currentLoads.length>=this._maxConnections)break;var n=this._loadQueue[e];if(this.maintainScriptOrder&&n instanceof createjs.TagLoader&&n.getItem().type==createjs.LoadQueue.JAVASCRIPT){if(this._currentlyLoadingScript)continue;this._currentlyLoadingScript=!0}this._loadQueue.splice(e,1),e--,t--,this._loadItem(n)}},t._loadItem=function(e){e.addEventListener("progress",createjs.proxy(this._handleProgress,this)),e.addEventListener("complete",createjs.proxy(this._handleFileComplete,this)),e.addEventListener("error",createjs.proxy(this._handleFileError,this)),this._currentLoads.push(e),this._sendFileStart(e.getItem()),e.load()},t._handleFileError=function(e){var t=e.target;this._numItemsLoaded++,this._updateProgress();var e={item:t.getItem()};this._sendError(e),this.stopOnError||(this._removeLoadItem(t),this._loadNext())},t._handleFileComplete=function(e){var t=e.target,n=t.getItem();this._loadedResults[n.id]=t.getResult(),t instanceof createjs.XHRLoader&&(this._loadedRawResults[n.id]=t.getResult(!0)),this._removeLoadItem(t);if(this.maintainScriptOrder&&n.type==createjs.LoadQueue.JAVASCRIPT){if(!(t instanceof createjs.TagLoader)){this._loadedScripts[this._scriptOrder.indexOf(n)]=n,this._checkScriptLoadOrder(t);return}this._currentlyLoadingScript=!1}this._processFinishedLoad(n,t)},t._processFinishedLoad=function(e,t){this._numItemsLoaded++,this._updateProgress(),this._sendFileComplete(e,t),this._loadNext()},t._checkScriptLoadOrder=function(){var e=this._loadedScripts.length;for(var t=0;t<e;t++){var n=this._loadedScripts[t];if(n===null)break;if(n===!0)continue;this._processFinishedLoad(n),this._loadedScripts[t]=!0,t--,e--}},t._removeLoadItem=function(e){var t=this._currentLoads.length;for(var n=0;n<t;n++)if(this._currentLoads[n]==e){this._currentLoads.splice(n,1);break}},t._handleProgress=function(e){var t=e.target;this._sendFileProgress(t.getItem(),t.progress),this._updateProgress()},t._updateProgress=function(){var e=this._numItemsLoaded/this._numItems,t=this._numItems-this._numItemsLoaded;if(t>0){var n=0;for(var r=0,i=this._currentLoads.length;r<i;r++)n+=this._currentLoads[r].progress;e+=n/t*(t/this._numItems)}this._sendProgress(e)},t._disposeItem=function(e){delete this._loadedResults[e.id],delete this._loadedRawResults[e.id],delete this._loadItemsById[e.id],delete this._loadItemsBySrc[e.src]},t._createTag=function(e){var t=null;switch(e){case createjs.LoadQueue.IMAGE:return document.createElement("img");case createjs.LoadQueue.SOUND:return t=document.createElement("audio"),t.autoplay=!1,t;case createjs.LoadQueue.JSONP:case createjs.LoadQueue.JAVASCRIPT:return t=document.createElement("script"),t.type="text/javascript",t;case createjs.LoadQueue.CSS:return this.useXHR?t=document.createElement("style"):t=document.createElement("link"),t.rel="stylesheet",t.type="text/css",t;case createjs.LoadQueue.SVG:return this.useXHR?t=document.createElement("svg"):(t=document.createElement("object"),t.type="image/svg+xml"),t}return null},t._getTypeByExtension=function(e){switch(e.toLowerCase()){case"jpeg":case"jpg":case"gif":case"png":case"webp":case"bmp":return createjs.LoadQueue.IMAGE;case"ogg":case"mp3":case"wav":return createjs.LoadQueue.SOUND;case"json":return createjs.LoadQueue.JSON;case"xml":return createjs.LoadQueue.XML;case"css":return createjs.LoadQueue.CSS;case"js":return createjs.LoadQueue.JAVASCRIPT;case"svg":return createjs.LoadQueue.SVG;default:return createjs.LoadQueue.TEXT}},t._sendFileProgress=function(e,t){if(this._isCanceled()){this._cleanUp();return}var n={target:this,type:"fileprogress",progress:t,loaded:t,total:1,item:e};this.onFileProgress&&this.onFileProgress(n),this.dispatchEvent(n)},t._sendFileComplete=function(e,t){if(this._isCanceled())return;var n={target:this,type:"fileload",loader:t,item:e,result:this._loadedResults[e.id],rawResult:this._loadedRawResults[e.id]};e.completeHandler&&e.completeHandler(n),this.onFileLoad&&this.onFileLoad(n),this.dispatchEvent(n)},t._sendFileStart=function(e){var t={target:this,type:"filestart",item:e};this.dispatchEvent(t)},t.toString=function(){return"[PreloadJS LoadQueue]"},n.proxy=function(e,t){return function(){return e.apply(t,arguments)}},createjs.LoadQueue=e,createjs.proxy||(createjs.proxy=function(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){return e.apply(t,Array.prototype.slice.call(arguments,0).concat(n))}});var r=function(){};r.init=function(){var e=navigator.userAgent;r.isFirefox=e.indexOf("Firefox")>-1,r.isOpera=window.opera!=null,r.isChrome=e.indexOf("Chrome")>-1,r.isIOS=e.indexOf("iPod")>-1||e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1},r.init(),createjs.LoadQueue.BrowserDetect=r,Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(this==null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;arguments.length>1&&(r=Number(arguments[1]),r!=r?r=0:r!=0&&r!=Infinity&&r!=-Infinity&&(r=(r>0||-1)*Math.floor(Math.abs(r))));if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(i in t&&t[i]===e)return i;return-1})}();